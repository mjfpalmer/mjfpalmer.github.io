<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Michael Palmer</title>
  <base href="/">

  <link rel="manifest" href="/manifest.json">

  <link rel="stylesheet" href="/bootstrap-5.3.2-dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/site.css">

  <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <meta name="msapplication-TileColor" content="#585858">
  <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#585858">

  <style>
    body {
      margin-bottom: 88px;
    }

    main {
      height: calc(100vh - 92px);
      overflow-y: auto;
    }

    .footer {
      height: 88px;
    }
  </style>
</head>

<body>
  <main role="main" class="container">
    <div id="divLog" class="my-2"></div>
  </main>

  <footer class="footer bg-black fixed-bottom container" data-bs-theme="dark">
    <div id="inputs">
      <input type="text" id="inputtext" class="form-control bg-transparent text-white" value="" />
      <input type="number" id="inputinteger" min="0" max="1000" step="1" class="form-control bg-transparent text-white" value="" />
    </div>
    <div class="mt-1">
      <input type="text" id="input" class="w-100 bg-transparent text-white form-control" />
    </div>
  </footer>

  <script type="text/javascript" src="/scripts/jquery-3.7.1.min.js"></script>
  <script type="text/javascript" src="/bootstrap-5.3.2-dist/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/scripts/site.js"></script>

  <script type="text/javascript">
    $(function () {
      let game = new Game();
    });

    function Game() {
      let game = this;

      this.Player = null;
      this.MaxMultiply = 12;
      this.MaxDivide = 12;
      this.MaxAdd = 50;
      this.MaxSubtract = 50;
      this.SumCount = 20;

      this.Sums = [];
      this.Sum = new Sum();

      this.CurrentCard = null;

      this.Feedback = [
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Getting there", "Not too bad"],
        ["Well done", "Nice", "Conratulations"],
        ["Excellent", "Awesome", "Amazing"],
        ["Spectacular", "Perfect", "Brilliant", "Whoop whoop"]
      ];

      this.setPlayer = function (player) {
        game.Player = player;
        game.log(game.Player, false, false);
        game.log("Maximum number to multiply? ", true);
        game.onInput(game.SetMaxMultiply, "12", "integer");
      }

      this.SetMaxMultiply = function (maxMultiply) {
        if (maxMultiply !== "" && !isNaN(maxMultiply)) {
          game.MaxMultiply = parseInt(maxMultiply);
        }
        game.log(game.MaxMultiply, false, false);
        game.log("Maximum number to divide? ", true);
        game.onInput(game.SetMaxDivide, "12", "integer");
      }

      this.SetMaxDivide = function (maxDivide) {
        if (maxDivide !== "" && !isNaN(maxDivide)) {
          game.MaxDivide = parseInt(maxDivide);
        }
        game.log(game.MaxDivide);
        game.log("Maximum number to add? ", true);
        game.onInput(game.SetMaxAdd, "50", "integer");
      }

      this.SetMaxAdd = function (maxAdd) {
        if (maxAdd !== "" && !isNaN(maxAdd)) {
          game.MaxAdd = parseInt(maxAdd);
        }
        game.log(game.MaxAdd, false, false);
        game.log("Maximum number to subtract? ", true);
        game.onInput(game.SetMaxSubtract, "50", "integer");
      }

      this.SetMaxSubtract = function (maxSubtract) {
        if (maxSubtract !== "" && !isNaN(maxSubtract)) {
          game.MaxSubtract = parseInt(maxSubtract);
        }
        game.log(game.MaxSubtract, false, false);
        game.log("How many sums? ", true);
        game.onInput(game.SetSumCount, "20", "integer");
      }

      this.SetSumCount = function (sumCount) {
        if (sumCount !== "" && !isNaN(sumCount)) {
          game.SumCount = parseInt(sumCount);
        }
        game.log(game.SumCount, false, false);
        game.clearLog();

        game.NextSum();
      }

      this.NextSum = function () {
        if (game.Sums.length < game.SumCount) {
          game.Sum = new Sum(game);
          game.Sums.push(game.Sum);
          game.log(`${game.Sum.Num1} ${game.Sum.OperatorSymbol()} ${game.Sum.Num2} = `, true);
          game.onInput(game.Answer, "", "integer");
        } else {
          game.GameOver();
        }
      }

      this.Answer = function (answer) {
        if (answer !== "" && !isNaN(answer)) {
          game.Sum.PlayerAnswer = parseInt(answer);
        }
        game.log(game.Sum.PlayerAnswer, false, false);

        if (game.Sum.Correct()) {
          game.log("&nbsp;&nbsp;&check;", false, false, "#0ed145");
        } else {
          game.log("&nbsp;&nbsp;&cross;", false, false, "#ec1c24");
          game.log(`The correct answer was <span style="color: #0ed145;">${game.Sum.Answer}</span>`, false, true);
        }

        game.NextSum();
      }

      this.GameOver = function () {
        let correct = game.Sums.filter((s) => s.Correct()).length;
        let incorrect = game.Sums.length - correct;
        let percentage = Math.round(correct / game.Sums.length * 100);
        let feedback = game.Feedback[Math.floor(percentage / 10)][Math.floor(Math.random() * game.Feedback[Math.floor(percentage / 10)].length)];
        game.log(`${feedback} ${game.Player}, you got ${percentage}% (${correct} correct and ${incorrect} incorrect).`, true);
        game.log("Play again (y/n)? ", true);
        game.onInput(game.PlayAgain, "y", "text");
      }

      this.PlayAgain = function (playAgain) {
        if (playAgain.toLowerCase() === "y") {
          game.clearLog();
          game.Sums = [];
          game.NextSum();
        } else {
          window.location.href = "/index.html";
        }
      }

      this.onInput = function (handler, value, type) {
        game.HideInputs();

        $(`#input${type}`)
          .show()
          .on("keyup", function (e) {
            if (e.key == 'Enter') {
              $(e.target).trigger("focusout");
            }
          })
          .on("focusout", function (e) {
            let v = $(e.target).val();
            if (v !== "") {
              $(e.target).off().val("");
              handler(v);
            }
          })
          .val(value)
          .trigger("focus");
      }

      this.HideInputs = function () {
        $("#inputs").children().hide();
      }

      this.log = function (html, newCard, newLine, colour) {
        if (newLine === undefined) { newLine = true; }
        if (newCard) {
          game.CurrentCard = $(document.createElement('div'))
            .addClass("card text-white bg-dark fs-3 mt-2")
            .appendTo("#divLog");

          $(document.createElement('div'))
            .addClass("card-body")
            .appendTo(game.CurrentCard);
        }

        if (newLine) {
          $(document.createElement('div'))
            .appendTo(game.CurrentCard.children(".card-body").last());
        }

        $(document.createElement('span'))
          .css("color", colour ? colour : "inherit")
          .html(html)
          .appendTo(game.CurrentCard.children(".card-body").last().children("div").last());

        $("main").scrollTop(Number.MAX_SAFE_INTEGER);
      }

      this.clearLog = function () {
        $("#divLog").empty();
      }

      game.log("Who's playing? ", true);
      game.onInput(this.setPlayer, "", "text");
    }

    function Sum(game) {
      let sum = this;

      this.Operators = {
        Multiply: 0,
        Divide: 1,
        Add: 2,
        Subtract: 3
      };

      this.Game = game;

      this.Operator = 0;
      this.Num1 = 0;
      this.Num2 = 0;
      this.Answer = 0;

      this.Num1s = [];
      this.Num2s = [];

      this.PlayerAnswer = null;

      this.SetNum1s = () => {
        sum.Num1s = [];

        switch (sum.Operator) {
          case sum.Operators.Multiply: sum.Num1s = new Array(sum.Game.MaxMultiply + 1).fill(0).map((n, i) => i); break;
          case sum.Operators.Divide:
            for (let i = 2; i <= sum.Game.MaxDivide; i++) {
              for (let j = i; j <= sum.Game.MaxDivide; j++) {
                let product = i * j;
                if (sum.Num1s.indexOf(product) === -1) {
                  sum.Num1s.push(product);
                }
              }
            }
            break;
          case sum.Operators.Add: sum.Num1s = new Array(sum.Game.MaxAdd + 1).fill(0).map((n, i) => i); break;
          case sum.Operators.Subtract: sum.Num1s = new Array(sum.Game.MaxSubtract + 1).fill(0).map((n, i) => i); break;
        }
      };

      this.SetNum2s = () => {
        sum.Num2s = [];

        switch (sum.Operator) {
          case sum.Operators.Multiply: sum.Num2s = new Array(sum.Game.MaxMultiply + 1).fill(0).map((n, i) => i); break;
          case sum.Operators.Divide:
            for (let i = 1; i <= sum.Game.MaxDivide; i++) {
              if (sum.Num1 % i == 0) {
                if (sum.Num2s.indexOf(i) === -1) {
                  sum.Num2s.push(i);
                }
              }
            }
            break;
          case sum.Operators.Add: sum.Num2s = new Array(sum.Game.MaxAdd + 1).fill(0).map((n, i) => i); break;
          case sum.Operators.Subtract: sum.Num2s = new Array(sum.Num1 + 1).fill(0).map((n, i) => i); break;
        }
      };

      this.OperatorSymbol = () => {
        switch (sum.Operator) {
          case sum.Operators.Multiply: return "&times;";
          case sum.Operators.Divide: return "&divide;";
          case sum.Operators.Add: return "&plus;";
          case sum.Operators.Subtract: return "&minus;";
        }
      };

      this.Correct = () => {
        return sum.PlayerAnswer === sum.Answer;
      };

      if (game) {
        do {
          sum.Operator = Math.floor(Math.random() * 4);
          sum.SetNum1s();
          sum.Num1 = sum.Num1s[Math.floor(Math.random() * sum.Num1s.length)];
          sum.SetNum2s();
          sum.Num2 = sum.Num2s[Math.floor(Math.random() * sum.Num2s.length)];
        } while (sum.Game.Sums.some((s) => {
          return s.Operator === sum.Operator
            && Math.min(s.Num1, s.Num2) === Math.min(sum.Num1, sum.Num2)
            && Math.max(s.Num1, s.Num2) === Math.max(sum.Num1, sum.Num2);
        }));

        switch (sum.Operator) {
          case sum.Operators.Multiply: sum.Answer = sum.Num1 * sum.Num2; break;
          case sum.Operators.Divide: sum.Answer = sum.Num1 / sum.Num2; break;
          case sum.Operators.Add: sum.Answer = sum.Num1 + sum.Num2; break;
          case sum.Operators.Subtract: sum.Answer = sum.Num1 - sum.Num2; break;
        }
      }
    }
  </script>
</body>
</html>