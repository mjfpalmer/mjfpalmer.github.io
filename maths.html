<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, shrink-to-fit=no, interactive-widget=resizes-content">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Michael Palmer</title>
  <base href="/">

  <link rel="manifest" href="/manifest.json">

  <link rel="stylesheet" href="/bootstrap-5.3.2-dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/site.css">

  <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <meta name="msapplication-TileColor" content="#585858">
  <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#585858">
</head>

<body>
  <main role="main" class="container">
    <div id="divLog" class="my-2"></div>
  </main>

  <footer class="footer bg-black fixed-bottom container" data-bs-theme="dark">
    <input type="text" id="ci" class="w-100 bg-transparent text-white form-control" />
  </footer>

  <script type="text/javascript" src="/scripts/jquery-3.7.1.min.js"></script>
  <script type="text/javascript" src="/bootstrap-5.3.2-dist/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/scripts/site.js"></script>
  <script type="text/javascript" src="/scripts/maths.js"></script>

  <script type="text/javascript">
    $(function () {
      let game = new Game();

      $("#ci")
        .off("keyup")
        .on("keyup", function (e) {
          if (e.key == 'Enter') {
            let value = $(e.target).val();
            $(e.target).val("");

            if (value !== "") {
              if (game.OnInputHandler) {
                game.OnInputHandler(value);
              }
            }

            site.OnConsoleKeyUpEnter(value);
          }
        })
    });

    function Game() {
      let game = this;

      this.OnInputHandler = null;

      this.Maths = null;

      this.Player = null;
      this.Grade = 4;
      this.QuestionCount = 20;

      this.Questions = [];
      this.QuestionIndex = 0;
      this.Question = null;

      this.CurrentCard = null;

      this.Feedback = [
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Getting there", "Not too bad"],
        ["Well done", "Nice", "Conratulations"],
        ["Excellent", "Awesome", "Amazing"],
        ["Spectacular", "Perfect", "Brilliant", "Whoop whoop"]
      ];

      this.SetPlayer = function (player) {
        game.Player = player;
        game.Log(game.Player, false, false);
        game.Log("What grade are you in? ", true);
        game.OnInput(game.SetGrade, "4", "number");
      }

      this.SetGrade = function (grade) {
        if (grade !== "" && !isNaN(grade)) {
          game.Grade = parseInt(grade);
          game.Maths = new Maths(game.Grade);
        }

        game.Log("How many questions? ", true);
        game.OnInput(game.SetQuestionCount, "20", "number");
      }

      this.SetQuestionCount = function (questionCount) {
        if (questionCount !== "" && !isNaN(questionCount)) {
          game.QuestionCount = parseInt(questionCount);
        }

        game.Log(game.QuestionCount, false, false);
        game.ClearLog();

        game.NextQuestion();
      }

      this.NextQuestion = function () {
        if (game.Questions.length === 0) {
          game.Questions = game.Maths.GetQuestions(game.QuestionCount);
        }

        if (game.QuestionIndex < game.QuestionCount) {
          game.Question = game.Questions[game.QuestionIndex++];

          game.Log(game.Question.Question, true);
          game.OnInput(game.Answer, "", game.Question.AnswerType);
        } else {
          game.GameOver();
        }
      }

      this.Answer = function (answer) {
        if (answer !== "" && !isNaN(answer)) {
          game.Question.PlayerAnswer = parseInt(answer);
        }
        game.Log(game.Question.PlayerAnswer, false, false);

        if (game.Question.Correct()) {
          game.Log("&nbsp;&nbsp;&check;", false, false, "#0ed145");
        } else {
          game.Log("&nbsp;&nbsp;&cross;", false, false, "#ec1c24");
          game.Log(`The correct answer was <span style="color: #0ed145;">${game.Question.Answer}</span>`, false, true);
        }

        game.NextQuestion();
      }

      this.GameOver = function () {
        let correct = game.Questions.filter((q) => q.Correct()).length;
        let incorrect = game.Questions.length - correct;
        let percentage = Math.round(correct / game.Questions.length * 100);
        let feedback = game.Feedback[Math.floor(percentage / 10)][Math.floor(Math.random() * game.Feedback[Math.floor(percentage / 10)].length)];
        game.Log(`${feedback} ${game.Player}, you got ${percentage}% (${correct} correct and ${incorrect} incorrect).`, true);
        game.Log("Play again (y/n)? ", true);
        game.OnInput(game.PlayAgain, "", "text");
      }

      this.PlayAgain = function (playAgain) {
        if (playAgain.toLowerCase() === "y") {
          game.ClearLog();
          game.Questions = [];
          game.QuestionIndex = 0;
          game.NextQuestion();
        } else {
          window.location.href = "/index.html";
        }
      }

      this.OnInput = function (handler, value, type) {
        game.OnInputHandler = handler;

        $(`#ci`)
          .prop({ type: type })
          .val(value)
          .trigger("focus");
      }

      this.Log = function (html, newCard, newLine, colour) {
        if (newLine === undefined) { newLine = true; }
        if (newCard) {
          game.CurrentCard = $(document.createElement('div'))
            .hide()
            .addClass("card text-white bg-dark fs-3 mt-2")
            .prependTo("#divLog");

          $(document.createElement('div'))
            .addClass("card-body")
            .appendTo(game.CurrentCard);
        }

        if (newLine) {
          $(document.createElement('div'))
            .appendTo(game.CurrentCard.children(".card-body").last())
        }

        $(document.createElement('span'))
          .hide()
          .css("color", colour ? colour : "inherit")
          .html(html)
          .appendTo(game.CurrentCard.children(".card-body").last().children("div").last())
          .fadeIn();

        if (newCard) {
          game.CurrentCard.slideDown();
        }
      }

      this.ClearLog = function () {
        $("#divLog").empty();
      }

      game.Log("Who's playing? ", true);
      game.OnInput(game.SetPlayer, "", "text");
    }
  </script>
</body>
</html>