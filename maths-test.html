<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Michael Palmer</title>
  <base href="/">

  <link rel="manifest" href="/manifest.json">

  <link rel="stylesheet" href="/bootstrap-5.3.2-dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/site.css">

  <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <meta name="msapplication-TileColor" content="#585858">
  <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#585858">
</head>

<body>
  <div class="container">
    <div id="divLog" class="mt-3"></div>

    <div id="inputs">
      <input type="text" id="inputtext" class="form-control" value="" />
      <input type="number" id="inputinteger" min="0" max="144" step="1" class="form-control" value="" />
      <button id="playAgain" class="btn btn-primary">Play Again?</button>
    </div>
  </div>

  <script type="text/javascript" src="/scripts/jquery-3.7.1.min.js"></script>
  <script type="text/javascript" src="/bootstrap-5.3.2-dist/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/scripts/site.js"></script>

  <script type="text/javascript">
$(function () {
      let game = new Game();

      $("#playAgain").on("click", function () {
        game.clearLog();
        game.Sums = [];
        game.NextSum();
      });
    });

    function Game() {
      let game = this;

      this.Player = null;
      this.MaxMultiply = 12;
      this.MaxDivide = 12;
      this.MaxAdd = 50;
      this.MaxSubtract = 50;
      this.SumCount = 20;

      this.Sums = [];
      this.Sum = new Sum();

      this.CurrentCard = null;

      this.Feedback = [
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Keep trying", "Better luck next time", "Keep practicing"],
        ["Getting there", "Not too bad"],
        ["Well done", "Nice", "Conratulations"],
        ["Excellent", "Awesome", "Amazing"],
        ["Spectacular", "Perfect", "Brilliant", "Whoop whoop"]
      ];

      this.setPlayer = function (player) {
        game.Player = player;
        game.log(game.Player);
        game.log("What's the maximum number to multiply (default: 12)?", true);
        game.onInput(game.SetMaxMultiply, "12", "integer");
      }

      this.SetMaxMultiply = function (maxMultiply) {
        if (maxMultiply !== "" && !isNaN(maxMultiply)) {
          game.MaxMultiply = parseInt(maxMultiply);
        }
        game.log(game.MaxMultiply);
        game.log("What's the maximum number to divide (default: 12)?", true);
        game.onInput(game.SetMaxDivide, "12", "integer");
      }

      this.SetMaxDivide = function (maxDivide) {
        if (maxDivide !== "" && !isNaN(maxDivide)) {
          game.MaxDivide = parseInt(maxDivide);
        }
        game.log(game.MaxDivide);
        game.log("What's the maximum number to add (default: 50)?", true);
        game.onInput(game.SetMaxAdd, "50", "integer");
      }

      this.SetMaxAdd = function (maxAdd) {
        if (maxAdd !== "" && !isNaN(maxAdd)) {
          game.maxAdd = parseInt(maxAdd);
        }
        game.log(game.MaxAdd);
        game.log("What's the maximum number to subtract (default: 50)?", true);
        game.onInput(game.SetMaxSubtract, "50", "integer");
      }

      this.SetMaxSubtract = function (maxSubtract) {
        if (maxSubtract !== "" && !isNaN(maxSubtract)) {
          game.MaxSubtract = parseInt(maxSubtract);
        }
        game.log(game.MaxSubtract);
        game.log("How many sums (default: 20)?", true);
        game.onInput(game.SetSumCount, "20", "integer");
      }

      this.SetSumCount = function (sumCount) {
        if (sumCount !== "" && !isNaN(sumCount)) {
          game.SumCount = parseInt(sumCount);
        }
        game.log(game.SumCount);
        game.clearLog();

        game.NextSum();
      }

      this.NextSum = function () {
        if (game.Sums.length < game.SumCount) {
          game.Sum = new Sum(game);
          game.Sums.push(game.Sum);
          game.log(`${game.Sum.Num1} ${game.Sum.OperatorSymbol()} ${game.Sum.Num2}`, true);
          game.onInput(game.Answer, "", "integer");
        } else {
          game.GameOver();
        }
      }

      this.Answer = function (answer) {
        if (answer !== "" && !isNaN(answer)) {
          game.Sum.PlayerAnswer = parseInt(answer);
        }
        game.log(game.Sum.PlayerAnswer);

        if (game.Sum.Correct()) {
          game.log("Correct!", false, "#0ed145");
        } else {
          game.log(`Incorrect. The correct answer was ${game.Sum.Answer}`, false, "#ec1c24");
        }

        game.NextSum();
      }

      this.GameOver = function () {
        let correct = game.Sums.filter((s) => s.Correct()).length;
        let incorrect = game.Sums.length - correct;
        let percentage = Math.round(correct / game.Sums.length * 100);
        let feedback = game.Feedback[Math.floor(percentage / 10)][Math.floor(Math.random() * game.Feedback[Math.floor(percentage / 10)].length)];
        game.log(`${feedback} ${game.Player}, you got ${percentage}% (${correct} correct and ${incorrect} incorrect).`, true);

        game.MoveInputs();

        $("#playAgain")
          .show()
          .trigger("focus");
      }

      this.onInput = function (handler, value, type) {
        game.MoveInputs();

        $(`#input${type}`)
          .show()
          .off("keyup")
          .on("keyup", function (e) {
            if (e.keyCode == 13) {
              let v = $(e.target).val();
              $(e.target).val("");
              handler(v);
            }
          })
          .val(value)
          .trigger("focus");
      }

      this.MoveInputs = function () {
        $("#inputs")
          .appendTo(game.CurrentCard.children(".card-footer").last())
          .children().hide();;
      }

      this.log = function (text, newCard, colour) {
        if (newCard) {
          game.CurrentCard = $(document.createElement('div'))
            .addClass("card mt-2")
            .appendTo("#divLog");

          $(document.createElement('div'))
            .addClass("card-body")
            .appendTo(game.CurrentCard);

          $(document.createElement('div'))
            .addClass("card-footer")
            .appendTo(game.CurrentCard);
        }

        $(document.createElement('div'))
          .css("color", colour ? colour : "inherit")
          .text(text)
          .appendTo(game.CurrentCard.children(".card-body").last());
      }

      this.clearLog = function () {
        $("#inputs").appendTo("body");
        $("#divLog").empty();
      }

      game.log("Who's playing?", true);
      game.onInput(this.setPlayer, "", "text");
    }

    function Sum(game) {
      let sum = this;

      this.Operators = {
        Multiply: 0,
        Divide: 1,
        Add: 2,
        Subtract: 3
      };

      this.Game = game;

      this.Operator = 0;
      this.Num1 = 0;
      this.Num2 = 0;
      this.Answer = 0;

      this.Num1s = [];
      this.Num2s = [];

      this.PlayerAnswer = null;

      this.SetNum1s = () => {
        sum.Num1s = [];

        switch (sum.Operator) {
          case sum.Operators.Multiply: sum.Num1s = new Array(sum.Game.MaxMultiply + 1).fill(0).map((n, i) => i); break;
          case sum.Operators.Divide:
            for (let i = 2; i <= sum.Game.MaxDivide; i++) {
              for (let j = i; j <= sum.Game.MaxDivide; j++) {
                let product = i * j;
                if (sum.Num1s.indexOf(product) === -1) {
                  sum.Num1s.push(product);
                }
              }
            }
            break;
          case sum.Operators.Add: sum.Num1s = new Array(sum.Game.MaxAdd + 1).fill(0).map((n, i) => i); break;
          case sum.Operators.Subtract: sum.Num1s = new Array(sum.Game.MaxSubtract + 1).fill(0).map((n, i) => i); break;
        }
      };

      this.SetNum2s = () => {
        sum.Num2s = [];

        switch (sum.Operator) {
          case sum.Operators.Multiply: sum.Num2s = new Array(sum.Game.MaxMultiply + 1).fill(0).map((n, i) => i); break;
          case sum.Operators.Divide:
            for (let i = 1; i <= sum.Game.MaxDivide; i++) {
              if (sum.Num1 % i == 0) {
                if (sum.Num2s.indexOf(i) === -1) {
                  sum.Num2s.push(i);
                }
              }
            }
            break;
          case sum.Operators.Add: sum.Num2s = new Array(sum.Game.MaxAdd + 1).fill(0).map((n, i) => i); break;
          case sum.Operators.Subtract: sum.Num2s = new Array(sum.Num1 + 1).fill(0).map((n, i) => i); break;
        }
      };

      this.OperatorSymbol = () => {
        switch (sum.Operator) {
          case sum.Operators.Multiply: return "*";
          case sum.Operators.Divide: return "/";
          case sum.Operators.Add: return "+";
          case sum.Operators.Subtract: return "-";
        }
      };

      this.Correct = () => {
        return sum.PlayerAnswer === sum.Answer;
      };

      if (game) {
        do {
          sum.Operator = Math.floor(Math.random() * 4);
          sum.SetNum1s();
          sum.Num1 = sum.Num1s[Math.floor(Math.random() * sum.Num1s.length)];
          sum.SetNum2s();
          sum.Num2 = sum.Num2s[Math.floor(Math.random() * sum.Num2s.length)];
        } while (sum.Game.Sums.some((s) => {
          return s.Operator === sum.Operator
            && Math.min(s.Num1, s.Num2) === Math.min(sum.Num1, sum.Num2)
            && Math.max(s.Num1, s.Num2) === Math.max(sum.Num1, sum.Num2);
        }));

        switch (sum.Operator) {
          case sum.Operators.Multiply: sum.Answer = sum.Num1 * sum.Num2; break;
          case sum.Operators.Divide: sum.Answer = sum.Num1 / sum.Num2; break;
          case sum.Operators.Add: sum.Answer = sum.Num1 + sum.Num2; break;
          case sum.Operators.Subtract: sum.Answer = sum.Num1 - sum.Num2; break;
        }
      }
    }
  </script>
</body>
</html>